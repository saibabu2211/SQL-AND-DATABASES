

## ðŸ§© MySQL Subqueries â€” From Scratch to Advanced

### âœ… What is a Subquery?

A **subquery** is a query nested inside another SQL statement. It returns data used by the outer query â€” like a temporary result set.

---

### ðŸ“Œ 1. Basic Subquery in `WHERE`

```sql
SELECT name, salary
FROM employees
WHERE salary > (
  SELECT AVG(salary) FROM employees
);
```

âœ… **Use Case:** Find employees earning above average.

---

### ðŸ“Œ 2. Subquery in `SELECT`

```sql
SELECT 
  name,
  (SELECT dept_name FROM departments WHERE dept_id = e.dept_id) AS department
FROM employees e;
```

âœ… **Use Case:** Add related info without a join.

---

### ðŸ“Œ 3. Subquery in `FROM` (Derived Table)

```sql
SELECT dept_id, avg_salary
FROM (
  SELECT dept_id, AVG(salary) AS avg_salary
  FROM employees
  GROUP BY dept_id
) AS dept_avg;
```

âœ… **Use Case:** Use aggregated data as a table.

---

### ðŸ“Œ 4. Correlated Subquery

```sql
SELECT name
FROM employees e
WHERE salary > (
  SELECT AVG(salary)
  FROM employees
  WHERE dept_id = e.dept_id
);
```

âœ… **Use Case:** Compare each employee to their departmentâ€™s average.

âš ï¸ **Note:** Runs once per row â€” can be slow on large datasets.

---

### ðŸ“Œ 5. Subquery with `IN`

```sql
SELECT name
FROM employees
WHERE dept_id IN (
  SELECT dept_id FROM departments WHERE location = 'Chennai'
);
```

âœ… **Use Case:** Filter using a list from another table.

---

### ðŸ“Œ 6. Subquery with `EXISTS`

```sql
SELECT name
FROM employees e
WHERE EXISTS (
  SELECT 1 FROM departments d WHERE d.dept_id = e.dept_id AND d.location = 'Chennai'
);
```

âœ… **Use Case:** Check if related data exists.

---

### ðŸ§  Subquery vs JOIN â€” When to Use

| Use Case | JOIN | Subquery |
|----------|------|----------|
| Combine columns from multiple tables | âœ… Yes | âœ… Yes |
| Filter based on related table | âœ… Yes | âœ… Yes |
| Aggregate then filter | âŒ Complex | âœ… Easier with subquery |
| Performance on large data | âœ… Faster | âŒ Slower (esp. correlated) |

---
Hereâ€™s a crystal-clear explanation of **Correlated Subqueries in MySQL**, tailored for your GitHub documentation or technical notes:

---

## ðŸ”„ Correlated Subqueries â€” MySQL Cheat Sheet

### âœ… What is a Correlated Subquery?

A **correlated subquery** is a subquery that **depends on the outer query** for its values. Itâ€™s evaluated **once per row** of the outer query â€” unlike regular subqueries, which run once globally.

---

### ðŸ“Œ Syntax Pattern

```sql
SELECT ...
FROM outer_table o
WHERE o.column OPERATOR (
  SELECT ...
  FROM inner_table i
  WHERE i.column = o.column
);
```

---

### ðŸ§ª Example: Employees Above Department Average

```sql
SELECT 
  emp_id,
  name,
  salary,
  dept_id
FROM employees e
WHERE salary > (
  SELECT AVG(salary)
  FROM employees
  WHERE dept_id = e.dept_id
);
```

ðŸ” **Explanation:**
- For each employee `e`, the subquery calculates the **average salary of their department**.
- Then it checks if `e.salary` is greater than that average.

---

### âš ï¸ Key Characteristics

| Feature | Behavior |
|--------|----------|
| Depends on outer query | âœ… Yes |
| Runs per outer row | âœ… Yes |
| Slower on large datasets | âŒ Can be inefficient |
| Useful for row-by-row comparisons | âœ… Yes |
| Can be replaced with JOIN + GROUP BY | âœ… Often better for performance |

---

### ðŸ” Performance Tip

If possible, rewrite correlated subqueries using `JOIN` and `GROUP BY` for better performance:

```sql
SELECT e.emp_id, e.name, e.salary, e.dept_id
FROM employees e
JOIN (
  SELECT dept_id, AVG(salary) AS avg_salary
  FROM employees
  GROUP BY dept_id
) d ON e.dept_id = d.dept_id
WHERE e.salary > d.avg_salary;
```

---

Let me know if youâ€™d like a tabular comparison of correlated vs non-correlated subqueries, or a real-world use case like filtering top-performing sales reps by region.
